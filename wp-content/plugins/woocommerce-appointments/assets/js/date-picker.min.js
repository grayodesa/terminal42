jQuery(document).ready(function(a){var b,c,d=wc_appointment_form_params.appointment_duration,e=1>d?1:d,f=e,g={init:function(){a("body").on("change","#wc_appointments_field_staff",this.date_picker_init),a(".wc-appointments-date-picker legend small.wc-appointments-date-picker-choose-date").show(),a(".wc-appointments-date-picker").each(function(){var b=a(this).closest("form"),c=b.find(".picker"),d=a(this).closest("fieldset");g.date_picker_init(c),a(".wc-appointments-date-picker-date-fields",d).hide(),a(".wc-appointments-date-picker-choose-date",d).hide()})},select_date_trigger:function(d){var e=a(this).closest("fieldset"),g=d.split("-"),h=parseInt(g[0],10),i=parseInt(g[1],10),j=parseInt(g[2],10);b=new Date(h,i-1,j),c=new Date(h,i-1,j+(parseInt(f,10)-1)),e.find("input.appointment_to_date_year").val(""),e.find("input.appointment_to_date_month").val(""),e.find("input.appointment_to_date_day").val(""),e.find("input.appointment_date_year").val(g[0]),e.find("input.appointment_date_month").val(g[1]),e.find("input.appointment_date_day").val(g[2]).change(),e.triggerHandler("date-selected",d)},date_picker_init:function(b){var c=a(b);c=a(b).is(".picker")?a(b):a(this).closest("form").find(".picker:eq(0)"),c.empty().removeClass("hasDatepicker").datepicker({dateFormat:a.datepicker.ISO_8601,showWeek:!1,showOn:!1,beforeShowDay:g.is_appointable,onSelect:g.select_date_trigger,minDate:c.data("min_date"),maxDate:c.data("max_date"),defaultDate:c.data("default_date"),numberOfMonths:1,showButtonPanel:!1,showOtherMonths:!1,selectOtherMonths:!1,closeText:wc_appointment_form_params.closeText,currentText:wc_appointment_form_params.currentText,prevText:wc_appointment_form_params.prevText,nextText:wc_appointment_form_params.nextText,monthNames:wc_appointment_form_params.monthNames,monthNamesShort:wc_appointment_form_params.monthNamesShort,dayNames:wc_appointment_form_params.dayNames,dayNamesMin:wc_appointment_form_params.dayNamesShort,firstDay:wc_appointment_form_params.firstDay,gotoCurrent:!0}),a(".ui-datepicker-current-day").removeClass("ui-datepicker-current-day");var d=c.closest("form"),e=parseInt(d.find("input.appointment_date_year").val(),10),f=parseInt(d.find("input.appointment_date_month").val(),10),h=parseInt(d.find("input.appointment_date_day").val(),10);if(e&&f&&h){var i=new Date(e,f-1,h);c.datepicker("setDate",i)}},is_appointable:function(d){var f=a(this).closest("form"),h=a(this).data("availability"),i=a(this).data("default-availability"),j=a(this).data("fully-scheduled-days"),k=a(this).data("partially-scheduled-days"),l=a(this).data("remaining-scheduled-days"),m=a(this).data("padding-days"),n=a(this).data("discounted-days"),o=wc_appointment_form_params.availability_span,p=wc_appointment_form_params.has_staff,q=wc_appointment_form_params.staff_assignment,r=0,s="",t="",u="";f.find("select#wc_appointments_field_staff").val()>0&&(r=f.find("select#wc_appointments_field_staff").val());var v=new Date(d),w=v.getFullYear(),x=v.getMonth()+1,y=v.getDate();if(j[w+"-"+x+"-"+y]&&(j[w+"-"+x+"-"+y][0]||j[w+"-"+x+"-"+y][r]))return[!1,"fully_scheduled",wc_appointment_form_params.i18n_date_fully_scheduled];if("undefined"!=typeof m&&m[w+"-"+x+"-"+y])return[!1,"not_appointable",wc_appointment_form_params.i18n_date_unavailable];if(""+w+x+y<wc_appointment_form_params.current_time)return[!1,"not_appointable",wc_appointment_form_params.i18n_date_unavailable];k&&k[w+"-"+x+"-"+y]&&((k[w+"-"+x+"-"+y][0]||k[w+"-"+x+"-"+y][r])&&(s+="partial_scheduled "),l[w+"-"+x+"-"+y][0]?s=s+"remaining_scheduled_"+l[w+"-"+x+"-"+y][0]+" ":l[w+"-"+x+"-"+y][r]&&(s=s+"remaining_scheduled_"+l[w+"-"+x+"-"+y][r]+" ")),d>=b&&c>=d&&(s="ui-datepicker-selected-day"),"undefined"!=typeof n&&n[w+"-"+x+"-"+y]&&(s+=" discounted_day",u+=n[w+"-"+x+"-"+y]),"start"===o&&(e=1);var z={start_date:d,number_of_days:e,fully_scheduled_days:j,availability:h,default_availability:i,has_staff:p,staff_id:r,staff_assignment:q},A=g.is_slot_appointable(z);return A?(t=s.indexOf("partial_scheduled")>-1?wc_appointment_form_params.i18n_date_partially_scheduled:s.indexOf("discounted_day")>-1?u:wc_appointment_form_params.i18n_date_available,[A,s+" appointable",t]):[A,s+" not_appointable",wc_appointment_form_params.i18n_date_unavailable]},is_slot_appointable:function(b){for(var c=b.default_availability,d=0;d<b.number_of_days;d++){var e=new Date(b.start_date);e.setDate(e.getDate()+d);var f=e.getFullYear(),h=e.getMonth()+1,i=e.getDate(),j=e.getDay();0===j&&(j=7);var k={staff_rules:b.availability[b.staff_id],date:e,default_availability:b.default_availability};if(c=g.is_staff_available(k),"automatic"===b.staff_assignment||b.has_staff&&0===b.staff_id){var l=a.extend({availability:b.availability,fully_scheduled_days:b.fully_scheduled_days},k);c=g.has_available_staff(l)}if(b.fully_scheduled_days[f+"-"+h+"-"+i]&&(b.fully_scheduled_days[f+"-"+h+"-"+i][0]||b.fully_scheduled_days[f+"-"+h+"-"+i][b.staff_id])&&(c=!1),!c)break}return c},is_staff_available:function(b){var c=b.default_availability,d=b.date.getFullYear(),e=b.date.getMonth()+1,f=b.date.getDate(),g=b.date.getDay(),h=a.datepicker.iso8601Week(b.date);return 0===g&&(g=7),b.fully_scheduled_days&&b.fully_scheduled_days[d+"-"+e+"-"+f]&&b.fully_scheduled_days[d+"-"+e+"-"+f][b.staff_id]?!1:(a.each(b.staff_rules,function(a,b){var i=b[0],j=b[1];try{switch(i){case"months":if("undefined"!=typeof j[e])return c=j[e],!1;break;case"weeks":if("undefined"!=typeof j[h])return c=j[h],!1;break;case"days":if("undefined"!=typeof j[g])return c=j[g],!1;break;case"custom":if("undefined"!=typeof j[d][e][f])return c=j[d][e][f],!1}}catch(k){}return!0}),c)},has_available_staff:function(a){for(var b in a.availability)if(b=parseInt(b,10),0!==b&&(a.staff_rules=a.availability[b],a.staff_id=b,g.is_staff_available(a)))return!0;return!1}};g.init()});