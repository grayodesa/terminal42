var ticketHeaderImage=window.ticketHeaderImage||{};!function(a,b,c){"use strict";ticketHeaderImage={uploader:function(){var a=wp.media({title:HeaderImageData.title,multiple:!1,library:{type:"image"},button:{text:HeaderImageData.button}});return a.on("close",function(){var b=a.state().get("selection").toJSON();b.length&&ticketHeaderImage.render(b[0])}),a.open(),!1},render:function(a){b("#tribe_ticket_header_preview").html(ticketHeaderImage.imgHTML(a)),b("#tribe_ticket_header_image_id").val(a.id),b("#tribe_ticket_header_remove").show()},imgHTML:function(a){var b='<img src="'+a.url+'" ';return b+='width="'+a.width+'" ',b+='height="'+a.height+'" ',b+="/>"}},b(document).ready(function(){function c(){return j.prop("checked")}function d(){l=!0,h.trigger("set-global-stock-fields.tribe")}function e(){b("tr.ticket_advanced").hide(),b("tr.ticket_advanced_"+f()+":not(.sale_price)").show(),h.trigger("set-advanced-fields.tribe"),b(document.getElementById("tribetickets")).trigger("ticket-provider-changed.tribe")}function f(){var a=b('input[name="ticket_provider"]:checked');return a.length>0?a[0].value:""}var g=b("#tribe-event-datepickers"),h=b("#tribetickets"),i=b("#event_tickets"),j=b("#tribe-tickets-enable-global-stock"),k=b("#tribe-tickets-global-stock-level"),l=!1,m=b("html, body"),n=0;h.on({"spin.tribe":function(a,c){("undefined"==typeof c||b.inArray(c,["start","stop"]))&&(c="stop"),"stop"===c?i.css("opacity","1").find("#tribe-loading").hide():i.css("opacity","0.5").find("#tribe-loading").show()},"clear.tribe":function(){var a=b(this),c=a.find("#ticket_form"),d=c.find("tr:not(.event-wide-settings)");a.find("a#ticket_form_toggle").show(),d.find('input:not(:button):not(:radio):not(:checkbox):not([type="hidden"]), textarea').val(""),d.find("input:checkbox").attr("checked",!1),d.find("#ticket_id").val(""),a.find('#ticket_form input[name="show_attendee_info"]').prop("checked",!1).change(),a.find("input[data-default-value]").each(function(){var a=b(this);a.val(a.data("default-value"))}),a.find("#ticket_start_date").datepicker("option","maxDate",null),a.find("#ticket_end_date").datepicker("option","minDate",null),a.find(".ticket_start_time, .ticket_end_time, .ticket.sale_price").hide(),a.find("#ticket_price").removeProp("disabled").siblings(".no-update-message").html("").hide().end().siblings(".description").show(),b("#tribe-tickets-attendee-sortables").empty(),b(".tribe-tickets-attendee-saved-fields").show(),c.hide()},"focus.tribe":function(){m.animate({scrollTop:i.offset().top-50},500)},"set-advanced-fields.tribe":function(){var a=b(this),c=a.find("#ticket_form"),d=c.find("tr.ticket_advanced:not(.ticket_advanced_meta)").find("input, select, textarea"),e=c.find("#ticket_provider:checked").val();d.each(function(){var a=b(this);a.attr("name")&&a.data("name",a.attr("name")).attr({name:"",id:""}),a.closest("tr").hasClass("ticket_advanced_"+e)&&a.data("name")&&0===a.attr("name").length&&a.attr({name:a.data("name"),id:a.data("name")})}),h.trigger("set-global-stock-fields.tribe"),b("#ticket_global_stock").change(function(){h.trigger("set-global-stock-fields.tribe")})},"set-global-stock-fields.tribe":function(){var a=f(),d=b(this).find("#ticket_form").find(".ticket_advanced_"+a);if(!(d.length<1)){var e=d.filter(".stock"),g=d.filter(".global-stock-mode"),h=g.filter(".sales-cap-field"),i=b("#ticket_global_stock").val(),j=c();if(k.toggle(j),g.toggle(c()),e.toggle(!j),j)switch(i){case"global":h.hide(),e.hide();break;case"capped":h.show(),e.hide();break;case"own":h.hide(),e.show()}}}}),g.length&&(n=g.data("startofweek"));var o={dateFormat:"yy-mm-dd",showAnim:"fadeIn",changeMonth:!0,changeYear:!0,numberOfMonths:3,firstDay:n,showButtonPanel:!0,onChange:function(){},onSelect:function(a,c){var d=b.datepicker.parseDate("yy-mm-dd",a);"ticket_start_date"===c.id?(b("#ticket_end_date").datepicker("option","minDate",d),d?b(".ticket_start_time").show():b(".ticket_start_time").hide()):(b("#ticket_start_date").datepicker("option","maxDate",d),d?b(".ticket_end_time").show():b(".ticket_end_time").hide())}};b("#ticket_start_date").datepicker(o).keyup(function(a){(8===a.keyCode||46===a.keyCode)&&b.datepicker._clearDate(this)}),b("#ticket_end_date").datepicker(o).keyup(function(a){(8===a.keyCode||46===a.keyCode)&&b.datepicker._clearDate(this)}),j.change(d),j.trigger("change"),l=!1,b("input[name=ticket_provider]:radio").change(function(){e()}),b("input[name=ticket_provider]:checked").each(function(){e()}),b("a#ticket_form_toggle").click(function(a){b("h4.ticket_form_title_edit").hide(),b("h4.ticket_form_title_add").show(),b(this).hide(),h.trigger("clear.tribe").trigger("set-advanced-fields.tribe").trigger("focus.tribe"),b("#ticket_form").show(),b(document.getElementById("tribetickets")).trigger("ticket-provider-changed.tribe"),a.preventDefault()}),b("#ticket_form_cancel").click(function(){h.trigger("clear.tribe").trigger("set-advanced-fields.tribe").trigger("focus.tribe")}),b("#ticket_form_save").click(function(a){var c=b("#ticket_form_table"),d=c.find("#ticket_provider:checked").val(),e=c.find(".ticket, .ticket_advanced_meta, .ticket_advanced_"+d);h.trigger("save-ticket.tribe",a).trigger("spin.tribe","start");var f={action:"tribe-ticket-add-"+b("input[name=ticket_provider]:checked").val(),formdata:e.find(".ticket_field").serialize(),post_ID:b("#post_ID").val(),nonce:TribeTickets.add_ticket_nonce};b.post(ajaxurl,f,function(a){h.trigger("saved-ticket.tribe",a),a.success&&(h.trigger("clear.tribe"),b("td.ticket_list_container").empty().html(a.data.html),b(".ticket_time").hide())},"json").complete(function(){h.trigger("spin.tribe","stop").trigger("focus.tribe")})}),h.on("click",".ticket_delete",function(a){a.preventDefault(),h.trigger("delete-ticket.tribe",a).trigger("spin.tribe","start");var c={action:"tribe-ticket-delete-"+b(this).attr("attr-provider"),post_ID:b("#post_ID").val(),ticket_id:b(this).attr("attr-ticket-id"),nonce:TribeTickets.remove_ticket_nonce};b.post(ajaxurl,c,function(a){h.trigger("deleted-ticket.tribe",a),a.success&&(h.trigger("clear.tribe"),b("td.ticket_list_container").empty().html(a.data))},"json").complete(function(){h.trigger("spin.tribe","stop")})}),h.on("click",".ticket_edit",function(a){a.preventDefault(),b("h4.ticket_form_title_edit").show(),b("h4.ticket_form_title_add").hide(),h.trigger("spin.tribe","start");var c={action:"tribe-ticket-edit-"+b(this).attr("attr-provider"),post_ID:b("#post_ID").val(),ticket_id:b(this).attr("attr-ticket-id"),nonce:TribeTickets.edit_ticket_nonce};b.post(ajaxurl,c,function(a){h.trigger("clear.tribe").trigger("set-advanced-fields.tribe").trigger("edit-ticket.tribe",a);var c=a.data.price,d=c,e=!1;"undefined"!=typeof a.data.on_sale&&a.data.on_sale&&(e=!0,c=a.data.regular_price),b("#ticket_id").val(a.data.ID),b("#ticket_name").val(a.data.name),b("#ticket_description").val(a.data.description),e&&b(".ticket_advanced_"+a.data.provider_class+".sale_price").show();var f=a.data.start_date.substring(0,10),g=a.data.end_date.substring(0,10);b("#ticket_start_date").val(f),b("#ticket_end_date").val(g);var i=b(document.getElementById("ticket_start_meridian")),j=b(document.getElementById("ticket_end_meridian"));if(a.data.start_date){var k=parseInt(a.data.start_date.substring(11,13)),l="am";k>12&&i.length&&(l="pm",k=parseInt(k)-12,k=("0"+k).slice(-2)),12===k&&(l="pm"),0===k&&"am"===l&&(k=12),k=k.toString(),1===k.length&&(k="0"+k),b("#ticket_start_hour").val(k),b("#ticket_start_meridian").val(l),b(".ticket_start_time").show()}if(a.data.end_date){var m=parseInt(a.data.end_date.substring(11,13)),n="am";m>12&&j.length&&(n="pm",m=parseInt(m)-12,m=("0"+m).slice(-2)),12===m&&(n="pm"),0===m&&"am"===n&&(m=12),m=m.toString(),1===m.length&&(m="0"+m),b("#ticket_end_hour").val(m),b("#ticket_end_meridian").val(n),b("#ticket_start_minute").val(a.data.start_date.substring(14,16)),b("#ticket_end_minute").val(a.data.end_date.substring(14,16)),b(".ticket_end_time").show()}var o=b("tr.ticket_advanced input");o.data("name",o.attr("name")).attr({name:"",id:""}),b("tr.ticket_advanced").remove(),b("tr.ticket.bottom").before(a.data.advanced_fields),b("input[name=ticket_provider]:radio").change();var p=h.find("#ticket_price");p.val(c),"undefined"!=typeof a.data.disallow_update_price_message?p.siblings(".no-update-message").html(a.data.disallow_update_price_message):p.siblings(".no-update-message").html(""),"undefined"==typeof a.data.can_update_price||a.data.can_update_price?(p.removeProp("disabled"),p.siblings(".description").show(),p.siblings(".no-update-message").hide()):(p.prop("disabled","disabled"),p.siblings(".description").hide(),p.siblings(".no-update-message").show());var q=h.find("#ticket_sale_price");e?q.val(d).closest("tr").show():q.closest("tr").hide(),"undefined"!=typeof a.data.purchase_limit&&a.data.purchase_limit&&b("#ticket_purchase_limit").val(a.data.purchase_limit),b("input:radio[name=ticket_provider]").filter("[value="+a.data.provider_class+"]").click(),h.find(".bumpdown-trigger").bumpdown(),h.find(".bumpdown").hide(),b("a#ticket_form_toggle").hide(),b("#ticket_form").show(),h.trigger("set-advanced-fields.tribe").trigger("edit-ticket.tribe")},"json").complete(function(){h.trigger("spin.tribe","stop").trigger("focus.tribe")})}).on("click","#tribe_ticket_header_image",function(a){a.preventDefault(),ticketHeaderImage.uploader("","")});var p=b("#tribe_ticket_header_remove"),q=b("#tribe_ticket_header_preview");if(q.find("img").length&&p.show(),k.change(function(){l=!0}),b('input[type="submit"]').click(function(){l=!1}),b(a).on("beforeunload",function(){return l?tribe_global_stock_admin_ui.nav_away_msg:void 0}),b("body").on("click","#tribe_ticket_header_remove",function(a){a.preventDefault(),q.html(""),p.hide(),b("#tribe_ticket_header_image_id").val("")}),b("#tribe_ticket_header_preview img").length){var r=b("#tribe_ticket_header_preview img");r.removeAttr("width").removeAttr("height"),h.width()<r.width()&&r.css("width","95%")}})}(window,jQuery);