var tribe_tickets_ticket_form={};!function(a,b){var c,d;b.init=function(){c=a(".tribe-events-tickets"),d=c.find(".quantity").find("input"),d.on("change",b.on_quantity_change)},b.on_quantity_change=function(){var c=a(this),d=b.get_matching_ticket_id(this);b.ticket_uses_global_stock(d)?b.global_stock_quantity_changed(c,d):b.normal_stock_quantity_changed(c,d)},b.global_stock_quantity_changed=function(a,c){var d=a.val(),e=b.get_event_id(c),f=b.get_cap(c),g=b.get_global_stock(e),h=b.currently_requested_global_event_stock(e);h>g&&(d-=h-g),b.stock_mode_is_capped(c)&&d>f&&(d=f),0>=d&&(d=0),a.val(d),b.update_available_stock_counts(e)},b.normal_stock_quantity_changed=function(a,d){var e,f=a.val(),g=b.get_single_stock(d);f>g&&(f=g),a.val(f),e=g-f,c.find(".available-stock[data-product-id="+d+"]").html(e)},b.update_available_stock_counts=function(d){var e=b.get_tickets_of(d),f=b.get_global_stock(d)-b.currently_requested_global_event_stock(d);for(var g in e)if(e.hasOwnProperty(g)){0>f&&(f=0);var h=e[g];if("global"===h.mode&&c.find(".available-stock[data-product-id="+g+"]").html(f),"capped"===h.mode){var i=Math.min(f,h.cap),j=parseInt(a("[data-product-id="+g+"]").find("input").val(),10),k=h.cap-j;0>k?k=0:k>i&&(k=i),c.find(".available-stock[data-product-id="+g+"]").html(k)}}},b.get_matching_ticket_id=function(b){var c=a(b).closest("[data-product-id]");if(c.length)return c.data("product-id")},b.get_ticket_property=function(a,b){if("object"!=typeof tribe_tickets_stock_data)return!1;var c=tribe_tickets_stock_data.tickets[a];return"undefined"===tribe_tickets_stock_data.tickets[a]?!1:c[b]},b.get_tickets_of=function(a){if("object"!=typeof tribe_tickets_stock_data)return!1;var b=[];for(var c in tribe_tickets_stock_data.tickets){var d=tribe_tickets_stock_data.tickets[c];a===d.event_id&&(b[c]=d)}return b},b.currently_requested_global_event_stock=function(a){var d=0,e=b.get_tickets_of(a);for(var f in e)switch(tribe_tickets_stock_data.tickets[f].mode){case"global":case"capped":d+=parseInt(c.find("[data-product-id="+f+"]").find("input").val(),10)}return d},b.get_event_property=function(a,b){if("object"!=typeof tribe_tickets_stock_data)return!1;var c=tribe_tickets_stock_data.events[a];return"undefined"===tribe_tickets_stock_data.events[a]?!1:c[b]},b.stock_mode_is_global=function(a){return"global"===b.get_mode(a)},b.stock_mode_is_capped=function(a){return"capped"===b.get_mode(a)},b.ticket_uses_global_stock=function(a){return b.stock_mode_is_capped(a)||b.stock_mode_is_global(a)},b.get_mode=function(a){return b.get_ticket_property(a,"mode")},b.get_event_id=function(a){return b.get_ticket_property(a,"event_id")},b.get_cap=function(a){return b.get_ticket_property(a,"cap")},b.get_global_stock=function(a){return b.get_event_property(a,"stock")},b.get_single_stock=function(a){return b.get_ticket_property(a,"stock")},a(function(){b.init()})}(jQuery,tribe_tickets_ticket_form);